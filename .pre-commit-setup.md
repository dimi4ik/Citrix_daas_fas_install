# Pre-Commit Hooks Setup Guide

## √úberblick

Pre-Commit Hooks automatisieren Code-Quality-Checks **vor** jedem Commit und verhindern, dass fehlerhafter Code committed wird.

## Installation

### 1. Pre-Commit Framework installieren

```powershell
# Option 1: Via pip (Python required)
pip install pre-commit

# Option 2: Via Chocolatey (Windows)
choco install pre-commit

# Option 3: Via Scoop (Windows)
scoop install pre-commit
```

### 2. Pre-Commit Hooks aktivieren

```bash
# Im Repository-Root ausf√ºhren
cd /path/to/Citrix_daas_fas_install
pre-commit install
```

**Output:**
```
pre-commit installed at .git/hooks/pre-commit
```

### 3. PowerShell Module installieren (erforderlich)

```powershell
# PSScriptAnalyzer f√ºr Code-Analyse
Install-Module -Name PSScriptAnalyzer -Scope CurrentUser -Force
```

## Verwendung

### Automatisch bei jedem Commit

Nach der Installation laufen die Hooks **automatisch** bei jedem `git commit`:

```bash
git add scripts/Deploy-FAS.ps1
git commit -m "feat: Add retry logic"
```

**Output (Beispiel):**
```
PowerShell Syntax Check.....................................................Passed
PSScriptAnalyzer............................................................Passed
Hardcoded Credential Detection..............................................Passed
Remove Trailing Whitespace..................................................Passed
JSON Syntax Validation......................................................Passed
Check for added large files.................................................Passed
Check for case conflicts....................................................Passed
Check for merge conflicts...................................................Passed
```

### Manuell alle Dateien pr√ºfen

```bash
# Alle Hooks auf alle Dateien anwenden
pre-commit run --all-files

# Einzelnen Hook ausf√ºhren
pre-commit run psscriptanalyzer --all-files
pre-commit run credential-check --all-files
```

### Hooks tempor√§r √ºberspringen

**Nicht empfohlen**, aber m√∂glich mit:

```bash
git commit --no-verify -m "WIP: Work in progress"
```

## Konfigurierte Hooks

### 1. **PowerShell Syntax Check** ‚úÖ
- Pr√ºft PowerShell-Syntax
- Verwendet PowerShell Parser
- **Fehler**: Commit wird blockiert

### 2. **PSScriptAnalyzer** ‚úÖ
- Code-Quality Analyse
- Best Practices Enforcement
- Security Checks
- **Fehler**: Commit wird blockiert
- **Warnungen**: Commit erlaubt, aber Review empfohlen

### 3. **Hardcoded Credential Detection** üîí
- Sucht nach hardcoded Passw√∂rtern
- Pr√ºft API Keys
- Validiert SIDs (au√üer Test-SIDs)
- **Fehler**: Commit wird blockiert

### 4. **Trailing Whitespace Removal** üßπ
- Entfernt trailing whitespace automatisch
- **Fix**: Datei wird ge√§ndert, Re-Stage erforderlich

### 5. **JSON Validation** üìã
- Validiert JSON-Syntax
- Pr√ºft alle `.json` Dateien
- **Fehler**: Commit wird blockiert

### 6. **Generic File Checks** üîç
- Large File Detection (max 500 KB)
- Case Conflict Detection
- Merge Conflict Detection
- Line Ending Normalization (CRLF f√ºr Windows)
- No Direct Commits to `main`/`master`

### 7. **Markdown Linting** üìù
- Validiert Markdown-Dateien
- Automatische Fixes wo m√∂glich
- Ausnahme: CHANGELOG.md

## Troubleshooting

### Hook schl√§gt fehl: "PSScriptAnalyzer not found"

```powershell
Install-Module -Name PSScriptAnalyzer -Scope CurrentUser -Force
```

### Hook schl√§gt fehl: "pwsh command not found"

Stelle sicher, dass PowerShell Core installiert ist:

```powershell
# Windows
winget install Microsoft.PowerShell

# macOS
brew install --cask powershell

# Linux
# https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell
```

### Hooks updaten

```bash
# Neue Hook-Versionen holen
pre-commit autoupdate

# Hooks neu installieren
pre-commit install --install-hooks
```

### Hook-Cache l√∂schen

```bash
pre-commit clean
```

## Best Practices

### 1. Regelm√§√üig alle Dateien pr√ºfen

```bash
# W√∂chentlich
pre-commit run --all-files
```

### 2. Hooks aktuell halten

```bash
# Monatlich
pre-commit autoupdate
```

### 3. CI/CD Integration

Die gleichen Checks laufen auch in GitHub Actions:

```yaml
# .github/workflows/powershell-tests.yml
- name: Run Pre-Commit Hooks
  run: |
    pip install pre-commit
    pre-commit run --all-files
```

### 4. Team-Wide Enforcement

Stelle sicher, dass alle Team-Mitglieder Pre-Commit installiert haben:

```bash
# Im Team-Setup-Script
git clone <repo>
cd <repo>
pip install pre-commit
pre-commit install
```

## Deaktivierung (nicht empfohlen)

```bash
# Hooks deinstallieren
pre-commit uninstall
```

## Weitere Informationen

- [Pre-Commit Dokumentation](https://pre-commit.com/)
- [PSScriptAnalyzer Rules](https://github.com/PowerShell/PSScriptAnalyzer)
- [Conventional Commits](https://www.conventionalcommits.org/)

---

**Fragen?** Siehe [CONTRIBUTING.md](CONTRIBUTING.md) oder erstelle ein Issue.
